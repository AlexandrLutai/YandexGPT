# Alfa CRM
## Class AlfaCRM
Предоставляет доступ к crm по API.

### Поля

_models - Словарь, хранящий пути, для отправки POST запросов к различным сущностям.

**_email** - Электронная почта, пользователя.
**_key** - Ключ пользователя.
**_hostname** - имя хоста.

([Данные поля необходими для получения временного ключа.] https://alfacrm.pro/knowledge/integration/api#googtrans(ru%7Cnull)
Значения для данных полей передаются в качестве параметров конструктора. Все данные, используемые для авторизации хранятся в отдельном файле.

**_header** - данное поле формируется методом **_fillHeader()**, и является словарём вида {'X-ALFACRM-TOKEN': tempToken}

***Временный токен необходим для ображения к api, время жизни токена***

За получение временного токена отвечает метод **_getTempToken()**
Данный метод возвращает временный токен строкой.

**_brunch** - данное поле хранит ветку с которой будет работать эксемпляр класса, за получение ветки отвечает метод **_getBrunches()** 
данный метод получает все доступные ветки и передаёт их методу **_getIdBrunches()**, с помощью которого выбирается одна ветка, оба метода возвращают целое число.

***<span style ='color:red'> Метод _getIdBrunches() не дописан, на данный момент он возвращает только ветку с индексом 1</span>***

### Проверка на валидность временного ключа.

<span style ='color:red'>На данный момент проверка на валидность
ключа осуществляется с помощью рекурсии:
</span>
```Python
if "items" in brunchDict:
    return self._getIdBrunches(brunchDict["items"])
else:
    self._fillHeader()
    return self._getBrunches()
```
<span style ='color:red'>
Данное решение сомнительно, переписать на основе Декораторов!
</span>

### Приватные методы.

Только описанные выше.

### Публичные методы

**getData(self,model:str, data: dict)** 
Параметры: 
-model - модель, к которой происхоит обращение в формате строки (Доступные модели можно увидеть в конструкторе класса AlfaCRM поле **_models**)
-data - словарь, содержащий данные для пост запроса, оформляется согласно [Документации]:https://alfacrm.pro/knowledge/integration/api#googtrans(ru%7Cnull)
Возвращает список полученных данных

## Class AlfaCRMDataWrapper
Получает данные и приводит их к виду, необходимому для записи в БД
### Поля класса
Формируются в конструкторе класса.
**_crm** - Содержит экземпляр класса [AlfaCRM](#class-alfacrm). Используется для получения данных из CRM.
**_DB** - Содержит экземпляр класса [DataBase](#). Используется для сохранения данных в локальную базу данных.
**_updatePeriodToNextLesson** - хранит период, за который будут вытягиваться данные о прошлых уроках.
**_updatePeriodToPreviousLesson** - - хранит период, за который будут вытягиваться данные о будующих уроках уроках.
